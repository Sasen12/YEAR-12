<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Simple SAT Backend Tester</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; }
    fieldset { margin-bottom: 16px; }
    pre { background: #f5f5f5; padding: 12px; max-height: 240px; overflow: auto; }
    label { display: block; margin: 6px 0; }
    button { margin-top: 8px; }
  </style>
</head>
<body>
  <h1>Simple Backend Tester</h1>
  <p>Use this page to register/login, fetch questions, grab a random quiz, and trigger exam imports.</p>

  <fieldset>
    <legend>Config</legend>
    <label>API Base URL:
      <input id="baseUrl" value="http://localhost:8000" size="40">
    </label>
    <label>JWT Token (auto-filled on login):
      <input id="token" size="80">
    </label>
  </fieldset>

  <fieldset>
    <legend>Register / Login</legend>
    <label>Username: <input id="username" value="demo"></label>
    <label>Password: <input id="password" type="password" value="demo"></label>
    <button onclick="register()">Register</button>
    <button onclick="login()">Login</button>
  </fieldset>

  <fieldset>
    <legend>Questions / Quiz</legend>
    <button onclick="listQuestions()">List Questions</button>
    <button onclick="randomQuiz()">Random Quiz</button>
  </fieldset>

  <fieldset>
    <legend>Import from Exams folder (server-side scan)</legend>
    <label>Year (optional): <input id="year" type="number" placeholder="e.g. 2024"></label>
    <button onclick="importFromExams()">Import</button>
  </fieldset>

  <h3>Output</h3>
  <pre id="output">Ready.</pre>

  <script>
    function show(obj) {
      const out = document.getElementById('output');
      out.textContent = typeof obj === 'string' ? obj : JSON.stringify(obj, null, 2);
    }

    function base() { return document.getElementById('baseUrl').value.trim().replace(/\/$/, ''); }
    function authHeader() {
      const t = document.getElementById('token').value.trim();
      return t ? { 'Authorization': 'Bearer ' + t } : {};
    }

    async function register() {
      const body = { username: username.value, password: password.value };
      const res = await fetch(base() + '/auth/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      show(await res.json());
    }

    async function login() {
      const body = { username: username.value, password: password.value };
      const res = await fetch(base() + '/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      const data = await res.json();
      if (data.access_token) {
        document.getElementById('token').value = data.access_token;
      }
      show(data);
    }

    async function listQuestions() {
      const res = await fetch(base() + '/softwaredev/questions');
      show(await res.json());
    }

    async function randomQuiz() {
      const res = await fetch(base() + '/softwaredev/quiz', { headers: authHeader() });
      show(await res.json());
    }

    async function importFromExams() {
      const y = document.getElementById('year').value;
      const url = base() + '/softwaredev/import_from_exams' + (y ? ('?year=' + y) : '');
      const res = await fetch(url, { method: 'POST', headers: authHeader() });
      show(await res.json());
    }
  </script>
</body>
</html>
